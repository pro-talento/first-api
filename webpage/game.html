<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Triqui</title>

  <style>
    table {
      border-collapse: collapse;
    }

    td {
      border: 1px solid black;
      width: 100px;
      height: 100px;
      text-align: center;
      font-size: 48px;
      cursor: pointer;
    }

    #reset-button {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  

  <body>
    <h1>Triqui</h1>
    <table id="game">
    </table>
    <button id="reset-button">Reset Game</button>

    <script>
      const INIT_GAME = [
        [null, null, null],
        [null, null, null],
        [null, null, null]
      ];

      let datos = [[...INIT_GAME[0]], [...INIT_GAME[1]], [...INIT_GAME[2]]]

      let currentTurn = "X"

      const gameTable = document.querySelector('#game');

      function renderBoard(game) {
        console.log('Se renderiza el board')
        const board = game.map((level, row_i) => {
          const cells = level.map((cell, cell_i) => `<td id="row-${row_i}-cell-${cell_i}">${cell ? cell : ''}</td>`).join('');
          const row = `<tr id="row-${row_i}">${cells}</tr>`;
          return row
        }).join('');
        return board;
      }
      
      function gameClick(row, cell) {
        datos[row][cell] = currentTurn;
        gameTable.innerHTML = renderBoard(datos);
        addEventListeners(datos);

        if (currentTurn === "X") {
          currentTurn = "O";
        } else { 
          currentTurn = "X";
        }
      }
    
      function addEventListeners(game) {
        console.log('Se generan los escuchadores')
        game.forEach((row, row_i) => row.forEach((cell, cell_i) => {
          const currentCellId = `row-${row_i}-cell-${cell_i}`;
          document.querySelector(`#${currentCellId}`).addEventListener('click', () => gameClick(row_i, cell_i))
        }))
      }
      
      function reset(game) {
        console.log('Reiniciar juego')
        datos = [[...INIT_GAME[0]], [...INIT_GAME[1]], [...INIT_GAME[2]]];
        gameTable.innerHTML = renderBoard(datos);
        addEventListeners(datos);
      }
      
      
      gameTable.innerHTML = renderBoard(datos);
      addEventListeners(datos);
      
      const btnReset = document.querySelector('#reset-button');
      btnReset.addEventListener('click', () => reset());

      
      // <tr>
      //   <td id="cell-0"></td>
      //   <td id="cell-1"></td>
      //   <td id="cell-2"></td>
      // </tr>
      // <tr>
      //   <td id="cell-3"></td>
      //   <td id="cell-4"></td>
      //   <td id="cell-5"></td>
      // </tr>
      // <tr>
      //   <td id="cell-6"></td>
      //   <td id="cell-7"></td>
      //   <td id="cell-8"></td>
      // </tr>
      // 1. Puede ser una "X" ✅
      // 2. Puede ser una "O" ✅
      // 3. Saber la posición ✅
      // 4. Si la celda esta o no ocupada ✅

      // v2 - Cuando ya sabemos que usuario participa      
      // 5. Saber el usuario
    </script>
  </body>
</body>
</html>